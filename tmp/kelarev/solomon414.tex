%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% AN ALGORITHM FOR SEMIGROUP ALGEBRAS 
%% WHICH ARE PRINCIPAL IDEAL RINGS
%% I.M.~Ara\'{u}jo, A.V.~Kelarev and  A.~Solomon 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[12pt]{article}
\usepackage{latexsym}  %%% we use $\Box$
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{algorithm,algorithmic}
%% \usepackage{mathrefs}
%% \pagestyle{empty}
\topmargin -0.5in
\textheight 21.6cm
\oddsidemargin 1.2cm
\textwidth 14cm
\parindent 5mm
\parskip .01in
\def\gap{\sf GAP}
\def\N{{\mathbb{N}}}
\def\char{{\mbox{char}}}
\def\max{{\mbox{max}}}

\newtheorem{theorem}{\qquad\bf Theorem}
\newtheorem{lemma}{Lemma}
\newtheorem{proposition}{\qquad\bf Proposition}
\newtheorem{definition}{\qquad\bf Definition}
\newtheorem{corollary}{\qquad\bf Corollary}
\newtheorem{notation}{\qquad\bf Notation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newenvironment{proof}{{\it Proof.\/}}{$\square$\\}
\newenvironment{proofthm}{{\it Proof\/}}{$\square$\\}
\newcommand{\gr}{{\,\rm gr\,}}
\def\bea{\begin{eqnarray*}}\def\eea{\end{eqnarray*}}
\renewcommand{\algorithmicrequire}{\textbf{Input:}}
\renewcommand{\algorithmicensure}{\textbf{Output:}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}
\
\vskip 3.5cm
\begin{center}
{\Large\bf AN ALGORITHM FOR \\[.1in]

SEMIGROUP ALGEBRAS WHICH ARE \\[.16in]

PRINCIPAL IDEAL RINGS}
\end{center}
\vskip .2in

\begin{center}
{\Large I.M.~Ara\'{u}jo, A.V.~Kelarev and  A.~Solomon}
\vskip .2in

{\it Department of Mathematics, University of St. Andrews\\
Fife KY16 9SS, United Kingdom}\\
isabel@dcs.st-and.ac.uk
\vskip .02in

{\it Department of Mathematics, University of Tasmania,\\
G.P.O.~Box~252-37, Hobart, Tasmania~7001, Australia}\\
Andrei.Kelarev@utas.edu.au
\vskip .02in

{\it Centre for Experimental and Constructive Mathematics\\
Department of Mathematics and Statistics, Simon Fraser University\\
Burnaby, British Columbia, Canada V5A 1S6}\\
andrew@illywhacker.net
\end{center}

\vskip .2in
%% \baselineskip 3.5ex

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction} 

Associative and commutative algebras with identity have various 
well-known applications. In particular, many classical codes 
are ideals in commutative algebras (see 
\cite{CaKe98:gwpc}, \cite{LaMa92:cciga} for references). 
Computer storage, encoding and decoding algorithms simplify if 
all these codes have single generator polynomials. Thus it
is of interest to determine when all ideals of an algebra are
{\em principal}, i.e., are generated by one element. An algebra $R$
is said to be a \textit{principal ideal ring} if all ideals
of $R$ are principal.  

In \cite{pDJW91} Decruyenaere, 
Jespers and Wauters characterized commutative semigroup algebras with 
identity which are principal ideal rings. 
In the more general case of noncommutative
algebras all principal ideal semigroup algebras have been described
by Jespers and Okninski \cite{JO96}. 

In this paper we develop an algorithm which, 
given a presentation for a commutative 
semigroup $S$ and the characteristic of a field $k$, 
decides whether the semigroup algebra $k[S]$ is a 
principal ideal ring with identity.
This builds upon the work of Rosales, Garc\'{\i}a-S\'{a}nchez and
Garc\'{\i}a-Garc\'{\i}a (\cite{pRGG99}, \cite{bRG99})
who have developed a number of useful algorithms for computing
with finitely presented commutative semigroups: most importantly
an algorithm to compute the (necessarily finite) set of idempotents.
Much of the remaining work depends on finding presentations
for ideals, subgroups and quotients of finitely presented 
commutative semigroups. This draws on techniques developed 
by Ru\v{s}kuc and others 
in \cite{CaRoRuTh:Reidmeister} and \cite{Ru99}
for finding presentations of subsemigroups.

In practical terms, this work has evolved from an 
ongoing project involving two of the authors
\cite{braga99} at the University of St.~Andrews to 
develop functionality within {\gap} \cite{gap} to compute with 
semigroups. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Background and Notation}

Green's relations are one of the  standard tools for 
structural analysis of semigroups (see, for example, Grillet's 
book \cite{Grillet:book}). In commutative semigroups, these 
relations all reduce to the single relation ${\cal H}$, which is 
defined by $a {\cal H} b$ precisely when $a$ and $b$ divide each 
other. A fact about Green's ${\cal H}$ relation to which we shall 
have recourse is that the ${\cal H}$-class containing an idempotent 
is precisely the maximal subgroup  of $S$ for which that idempotent 
is the identity.

Thus, the structure of a finitely presented commutative semigroup
can be understood in terms of the structure of its subgroups. 
It is well known that a finitely generated abelian group decomposes
as $\mathbb{Z}_{p_1^{k_1}} \times \cdots \times \mathbb{Z}_{p_m^{k_m}} 
\times \mathbb{Z}^q$, for some primes $p_i$.
One of the standard algorithms of computational
group theory (see Sims' book \cite{sims}), computes
$(p_1^{k_1}, \ldots, p_m^{k_m}, q)$ given a presentation for an 
abelian group. We refer to this algorithm as {\tt AbelianGroupDecomposition}.
For any prime $p$, denote by $Y_p$ the set $\{ i \mid p_i = p\}$. 
We refer to $\prod_{i \in Y_p}\mathbb{Z}_{p_i^{k_i}}$ as the  group's 
$p$-{\em primary component}, which is cyclic precisely when $Y$ 
is a singleton.  In parallel with {\tt AbelianGroupDecomposition}
is the algorithm {\tt IndependentGenerators} which returns a sequence
$(g_1, \ldots, g_m, h_1, \ldots, h_q)$ of elements of the group,
where the element $g_i$ generates the $i$-th finite 
cyclic factor $\mathbb{Z}_{p_i^{k_i}}$, and $h_i$ generates 
the $i$-th infinite cyclic factor.

Let $S$ be a semigroup with zero, but no proper divisors of zero.
Then we denote by $S_\theta$ the semigroup obtained by removing the
zero from $S$.

Let $M$ be a commutative monoid and $H$ a group of units.
Denote by $M/H$ the set $\{mH \mid m \in M\}$. It is a simple exercise
to see that this is a monoid, and we refer to it as the 
{\em quotient} of $M$ by $H$. Following  \cite{pDJW91}
we also say that $M$ is an {\em extension} of $H$ by $M/H$.
Note: care must be taken to distinguish this construction from 
the Rees quotient by an ideal. If $I$ is an ideal of $S$, a (not necessarily
commutative) semigroup, then the \emph{Rees quotient} of $S$ by $I$, 
written $S/I$ is the set $S \setminus I \cup \{0\}$ where 
the product of two elements in  $S \setminus I$ 
is defined to be $0$ if their product in $S$ lies in $I$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Finitely generated commutative semigroups}

Given an alphabet $A$, we denote by $A^+$ the free semigroup on $A$
and by $A^*$ the free monoid on $A$. Let $S$ be a semigroup and let
$\phi: A \rightarrow S$ be any map. 
Then if the homomorphic extension of
$\phi$ to $A^+$ is surjective, we say that $A$ 
{\em generates} the semigroup $S$ under $\phi$.
In general, when $A$ is a subset of $S$
there is no mention of the map, and it will be 
taken to be the natural inclusion.

Henceforth we consider only finitely generated commutative semigroups.
Let $(\N, +)$, or just $\N$,  denote the  semigroup whose
elements are the natural numbers (including 0) and whose operation is
addition. It is well known that the 
free commutative monoid on  $n$ generators is isomorphic to $\N^n$  
and the free commutative semigroup on $n$ generators is isomorphic to 
$(\N^n)_\theta$ where the operation $+$ is componentwise addition. 
We denote by $b_i$ the generator of $(\N^n)_\theta$ consisting of
a vector with zero everywhere but in position $i$ where there is a 
$1$. The set $\{b_1, \ldots, b_n\}$ is also called the {\em standard basis}
for $\N^n$.

The set $\N^n$ inherits a partial order from the
usual total order $\leq$ on $\mathbb{N}$, namely
$u \prec v$ if for each $1 \leq i \leq n$, $u_i \leq v_i$.
Indeed, both $\N^n$ and $(\N^n)_\theta$ are join semilattices when
one defines $u \vee v = (\max(u_1, v_1), \ldots, \max(u_n,v_n))$.
It is clear that if $u \prec v$ then $u + x \prec v + x$ and
$u \vee x \prec v \vee x$ both hold.
On $\mathbb{N}^n$ we consider another ordering: $\geq$ denotes
the \emph{total order} on vectors, also known as \emph{shortlex}. 

Suppose $A = \{a_1, \ldots, a_n\} \subseteq S$ generates 
$S$. Then there is a canonical homomorphism $\overline{\cdot}$
from $(\N^n)_\theta$ to $S$ given by 
$$(m_1, \ldots, m_n) \mapsto a_1^{m_1} a_2^{m_2} \ldots a_n^{m_n}.$$
In view of this we define a {\em commutative semigroup presentation} to
be an integer $n$ together with a set $\rho$ of pairs of elements 
of $(\N^n)_\theta$. We say that $\mathcal{P}=\langle n  \mid \rho \rangle$
is a presentation for the commutative semigroup $S$ if $S$ is generated
by an alphabet  $A$ of size $n$, and the kernel of the canonical map
from $(\N^n)_\theta$ to $S$ described above is precisely the smallest
congruence on $(\N^n)_\theta$ containing $\rho$.
We refer to $\rho$ as the set of \emph{relations} of $S$ and if
$x,y\in (\mathbb{N}^n)_{\theta}$ are such that there exists $(a,b)\in \rho$
with $a \prec x$ and  $y=x-a+b$ then we say that \emph{$y$ is obtained
from $x$ by application of one relation from $\rho$}.
Also, two elements $x,y\in\mathbb{N}^n$ satisfy $\overline{x}=
\overline{y}$ if and only if there exists a sequence 
$$x=\alpha_1,\alpha_2,\ldots,\alpha_h=y$$
of elements $\alpha_i\in(\mathbb{N}^n)_{\theta}$ ($1\leq i\leq h$)
such that each $\alpha_i$ is obtained from $\alpha_{i-1}$ by
one application of one relation from $\rho$,
and write $x\sim_{\mathcal{P}}y$ (or $x\sim_{\rho}y$).
If furthermore each $\alpha_{i}\geq\alpha_{i+1}$  
then we write $x\rightarrow^*y$ (or $x\rightarrow y$ if $h=2$).

Similarly we define a \emph{commutative monoid presentation}
by replacing $(\mathbb{N}^n)_{\theta}$ by $\mathbb{N}^n$ in
the above discussion. 

It is important to note that in the sequel, for an arbitrary 
commutative semigroup $S$, the binary operation will generally 
be written multiplicatively, while the operation of the free 
commutative semigroup, $(\mathbb{N}^n)_\theta$ will be written 
additively. Further, the identity of the free commutative monoid 
will be denoted by $0$ while the identity of a multiplicative 
monoid $M$ will be denoted by $1_M$ (or simply $1$).

Commutative semigroup and monoid presentations have some special 
properties. The following theorem may be found in any text on 
commutative semigroups, for example, \cite{bRG99}.

%%===================================================================
\begin{proposition}[Redei's Theorem]\label{Redei}
Every congruence on $(\N^n)_\theta$ is finitely generated, 
and therefore every finitely generated commutative 
semigroup is finitely presented.
\end{proposition}

Let $\langle n\mid\rho\rangle$ be a 
commutative semigroup presentation defining a semigroup $S$.
We say that $\rho$ is \emph{reduced} if $\rho$ is finite and if
$\rho=\{(l_1,r_1),\ldots,(l_m,r_m)\}$ 
then for all $i\in [m]$
\begin{itemize}
\item[(i)]
$r_i<l_i$
\item[(ii)]
$l_j\nprec l_i$ for all $j\neq i$
\item[(iii)]
$l_j\nprec r_i$ for all $j\in[r]$
\end{itemize} 
We say that $\langle n\mid\rho\rangle$ is a \emph{canonical presentation} 
if $\rho$ is reduced and for any two elements
$x,y\in(\mathbb{N}^n)_{\theta}$, $\overline{x}=\overline{y}$ if and 
only if there exists an element $z\in(\mathbb{N}^n)_{\theta}$ such
that $x\rightarrow^*z$ and $y\rightarrow^*z$.
In particular, $\rho$ determines an algorithm to solve the word
problem in $S$ (see, for example, \cite{bRG99})

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Algorithms for finitely generated commutative semigroups}

First, we recall a few well-known algorithms for semigroups 
and commutative semigroups needed for our main algorithm. 

\begin{proposition}[Knuth-Bendix rewriting process]
There is an algorithm which, given a presentation  
$\langle n  \mid \rho \rangle$,
produces a  subset $\kappa \subseteq 
(\N^n)_\theta \times (\N^n)_\theta$ such that 
the semigroup presented by $\langle n  \mid \rho \rangle$ and
the semigroup presented by $\langle n  \mid \kappa \rangle$ 
are isomorphic under the obvious correspondence,
and $\kappa$ is a canonical presentation.
\end{proposition}

In the case of commutative semigroups, this algorithm always terminates, 
so whenever a canonical presentation is required we will assume the use
of this algorithm. Rosales et.~al.~\cite{pRGG99} give an 
algorithm  which, given a semigroup $S = \langle n \mid \rho \rangle$, 
determines a (necessarily finite) set $E \subset \mathbb{N}^n$ which 
maps bijectively onto the set of idempotents of $S$. 
We refer to this algorithm as {\tt Idempotents}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Finding the basis of an ideal}

Let $Z$ be a subset of $S$, and let $ZS$ denote the ideal of 
$S$ generated by $Z$. The subset $I_Z$ of $\mathbb{N}^n$ consisting 
of vectors representing an element of $ZS$ 
is then an ideal of $\mathbb{N}^n$. Let $B$ denote the minimal 
elements of $I_Z$ under the partial order $\prec$ on $\mathbb{N}^n$.
By Dickson's Lemma (see, for example, \cite{bBeckWeis}) $B$ is a finite set,
and we refer to $B$ as the {\em basis} of the ideal $ZS$.

\begin{algorithm}
\caption{{\tt IdealBasis} Calculate the basis of an ideal}
\label{A:idealbasis}
\begin{algorithmic}[1]
\REQUIRE $S = \langle n \mid \rho \rangle$, $X$ a subset of $\mathbb{N}^n$.
We assume without loss of generality that the elements of $X$ are 
all independent under $\prec$.
\ENSURE $B \subset \mathbb{N}^n$, a basis for $\overline{X}S$.
\STATE $V_0 \leftarrow \emptyset$
\STATE $V_1 \leftarrow X$
\STATE $i \leftarrow 1$
\WHILE{$V_i \neq V_{i-1}$}
        \STATE $V_{i+1} \leftarrow V_i$
        \FORALL{$x \in V_i$} 
                \FORALL{$(a,b) \in \rho$} \label{step:forward}
                        \STATE $V_{i+1} \leftarrow $ minimal elements of 
                                $V_{i+1} \cup \{x \vee a - a + b\}$
                        \STATE $V_{i+1} \leftarrow $ minimal elements of 
                                $V_{i+1} \cup \{x \vee b - b + a\}$
                \ENDFOR
        \ENDFOR
        \STATE $i \leftarrow i + 1$
\ENDWHILE
\STATE {\bf return} $V_i$
\end{algorithmic}
\end{algorithm}

%%===================================================================
\begin{lemma}
Let $S$ be a commutative semigroup defined by a presentation $\langle
n\mid\rho\rangle$ and let $X$ be a finite subset of $\mathbb{N}^n$. Then
Algorithm \ref{A:idealbasis} calculates the basis
of $\overline{X}S$.
\end{lemma}

\begin{proof}
It is enough to show that if $u$ represents any element of
$\overline{X}S$ then there is some $k \in \mathbb{N}$ and
$x \in V_k$ with $x \prec u$. 

Now if $\overline{u} \in \overline{X}S$ then there is some
$x \in X$ and $v \in \mathbb{N}^n$ with
$x + v = u_0 \sim_\rho u_1 \sim_\rho u_2 \cdots \sim_\rho u_k = u$, for
some $k \in \mathbb{N}$. It is shown that $y \prec u$ for some
$y \in V_k$. 

Proceed by induction on $k$. If $k = 0$ then since
$x + v = u$, $x \prec u$ and putting $y = x$, we are done.
Now assume that for $k - 1$ the hypothesis holds.
Since $\overline{u} = \overline{u_k} = \overline{u_{k-1}}$,
is in the ideal of $S$ generated by $\overline{X}$, we certainly have
that there is some $z \in V_{k-1}$ with $z \prec u_{k-1}$.
If $u_{k-1}$ is transformed into $u_k$ by an application of the
relation $(a,b) \in \rho$, then $u_k = u_{k-1} - a + b$.
Step \ref{step:forward} ensures that  some divisor $y$ of  
$z \vee a -a + b$ is an element of $V_k$.
But since $a,z \prec  u_{k-1}$, we certainly have 
$z \vee a \prec u_{k-1}$ whence, 
$y \prec z \vee a -a + b \prec u_{k-1} - a + b = u_k$
as required. 
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Deciding whether a semigroup is free monogenic}\label{s:freemon}

Several known algorithms can decide whether a finitely presented
monoid $M$ is isomorphic to the free monogenic monoid 
$\mathbb{N}$ or cyclic group $\mathbb{Z}$. 
For example, using the results of \cite{p2} and \cite{p1},
Taitslin proved in \cite{taitslin} that the isomorphism problem
for finitely presented commutative semigroups is decidable, and 
has also developed a rather general algorithm which solves many 
other problems for commutative semigroups. Taitslin's result is 
very general, and for convenience of the reader we include 
another short self-contained algorithm in this section. 

First, we can check whether $M$ is cancellative (see \cite[Chapter 8]{bRG99}), 
and whether it is a group (see \cite{bRG99}). Then we can 
apply {\tt AbelianGroupDecomposition} and verify if $M$ is 
isomorphic to $\mathbb{Z}$. It only remains to decide 
whether a cancellative monoid is isomorphic to $\mathbb{N}$. 
This is done by Algorithm~\ref{A:fml2} included below.

Let $S$ be defined by the canonical presentation 
$\langle n \mid \rho \rangle$. Without loss of 
generality we may assume that no two generators 
represent the same element of $S$.

%%===================================================================
\begin{lemma}
If $S$ is free monogenic, then Algorithm \ref{A:fml1} determines
the unique $b_i\in\{b_1, ..., b_n\}$ such that $\overline{b_i}$ generates 
$S$ freely. If Algorithm \ref{A:fml1} returns \emph{fail} then
$S$ is not free monogenic.
\end{lemma}

\begin{proof}
If $S$ is free monogenic then
one of the $\overline{b_i}$ certainly generates it freely. Fix this generator.
Clearly $b_i\in Y$ (see line \ref{l:yline}). Now, suppose that $b_j\in Y$
with $j\neq i$. In particular $\overline{b_j}$ is not in the ideal generated
by $\overline{b_i}$. This contradicts the fact that $\overline{b_i}$ generates
$S$. Therefore $Y=\{b_i\}$. 
\end{proof}

\begin{algorithm}
\caption{For a canonical semigroup presentation $\langle n \mid \rho \rangle$ 
which defines the free monogenic semigroup, determines $i$ such that
$\overline{b_i}$ generates the whole semigroup}
\label{A:fml1}
\begin{algorithmic}[1]
\REQUIRE $S = \langle n \mid \rho \rangle$  a free monogenic semigroup
\ENSURE Unique generator of $S$.
\FORALL{$b_i$, $1\leq i\leq n$}
        \STATE $B_i\leftarrow$ {\tt IdealBasis}($\{b_j \mid j \neq i\}$)
\ENDFOR
\STATE $Y\leftarrow \{b_i\mid b_i\notin B_i\}$ \label{l:yline}
\IF{$|Y|\neq 1$}
\STATE {\bf return} \emph{fail}
\ELSE 
\STATE {\bf return} $b_i\in Y$
\ENDIF
\end{algorithmic}
\end{algorithm}

\begin{lemma}\label{l:freegen}
If $S$ is free monogenic and $\overline{b_i}$ generates $S$ then for each
$j \neq i$ there is some $1 < k_j \in \mathbb{N}$
such that $k_j b_i$ is  an element of {\tt IdealBasis}($b_j$)
and $\overline{k_jb_i} = \overline{b_j}$.
\end{lemma}

\begin{proof}
Since $S$ is monogenic and generated by $\overline{b_i}$, for
each $j \neq i$, there is some $k_j$ such 
that $\overline{k_j b_i} = \overline{b_j}$. Therefore, there is some
$h \leq k$ such that $h b_i \in $ {\tt IdealBasis}($b_j$). 
If $h < k$ then since $\overline{hb_i}  = \overline{b_j} s$ 
for some $s \in S$, and since $s = \overline{lb_i}$, for some $l>0$,
$\overline{hb_i} = \overline{k_jb_i}s = \overline{k_jb_i + lb_i}
= \overline{(k_j + l)b_i}$. This contradicts the assumption that $S$ is  
freely generated by $\overline{b_i}$. 
Therefore $k_jb_i \in ${\tt IdealBasis}($b_j$).
\end{proof}

The lemma above gives an algorithm {\tt GeneratorPower}($S,i, j$)
which, given a semigroup $S = \langle n \mid \rho \rangle$
freely generated by the single generator $\overline{b_i}$, returns $k$ such
that $\overline{kb_i} = \overline{b_j}$, or equivalently,
$\overline{b_i}^k = \overline{b_j}$. If no such power is found, then
$S$ is not free monogenic with generator $\overline{b_i}$ and the algorithm 
returns \emph{fail}.

With Algorithm  \ref{A:fml1} and {\tt GeneratorPower} at our disposal 
we see that Algorithm \ref{A:fml2} decides whether  a semigroup is
isomorphic to the free monogenic semigroup.
\begin{algorithm}
\caption{Determines whether a semigroup with canonical presentation
$\langle n \mid \rho \rangle$ is the free monogenic semigroup.}
\label{A:fml2}
\begin{algorithmic}[1]
\REQUIRE $S = \langle n \mid \rho \rangle$  
\ENSURE \emph{true} if $S$ is free monogenic, \emph{false} otherwise.
\IF{ Algorithm \ref{A:fml1} fails}
        \STATE{{\bf return} \emph{false}}
\ELSE
        \STATE $b_i \leftarrow $ generator returned by Algorithm \ref{A:fml1}.
\ENDIF
\FORALL{$j \neq i$}
        \IF{ {\tt GeneratorPower}($S,i, j$) returns \emph{fail}}
                \STATE {\bf return} \emph{false}
        \ELSE
                \STATE $k_j \leftarrow ${\tt GeneratorPower}($S,i, j$)
        \ENDIF
\ENDFOR
\STATE \COMMENT{Now we know that $S$ is monogenic, we replace
redundant 
generators and make it canonical using the Knuth-Bendix procedure}
\IF{the new presentation thus obtained is $\langle 1 | \rangle$}
        \STATE {\bf return} \emph{true}
\ELSE
        \STATE {\bf return} \emph{false}
\ENDIF
\end{algorithmic}
\end{algorithm}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Determining whether a semigroup algebra has identity}

There are many important examples of commutative algebras with
identity, for example, every commutative algebra generated as an ideal 
by a finite set of idempotents has an identity.
In \cite{poniz87} Theorem 1.4, Ponizovskii shows that an algebra 
of the semigroup $S$ will have identity precisely when 
\begin{equation}\label{eq:hasid}
S = \cup_{e \in E(S)}eS.
\end{equation}
(Notice that this is independent of the 
field over which the algebra is formed.)
We present an algorithm to determine whether
the algebra of a semigroup $S = \langle n \mid \rho\rangle$ has 
identity.

\begin{algorithm}
\caption{Ensures that every generator is in the principal 
ideal of some idempotent}
\label{A:hasid}
\begin{algorithmic}[1]
\REQUIRE $S = \langle n \mid \rho\rangle$ 
\STATE $E \leftarrow {\mbox{\tt Idempotents}}(S)$ \label{l:calcidemps} 
\STATE $B \leftarrow {\mbox{\tt IdealBasis}}(E)$ \label{l:unionbasis}
\IF{$b_i \notin B$ for any $i$}
\STATE {\bf return} \emph{false}
\ELSE
\STATE {\bf return} \emph{true}
\ENDIF
\end{algorithmic}
\end{algorithm}

%%===================================================================
\begin{lemma}\label{L:hasid}
Given a presentation $\langle n \mid \rho\rangle$ for a semigroup 
$S$, Algorithm \ref{A:hasid} determines whether or not
an algebra of $S$ over a field will have an identity.
\end{lemma}

\begin{proof}
In order to decide whether an algebra of $S$ has identity,
Algorithm \ref{A:hasid}
must verify that Equation \ref{eq:hasid} holds. 
We claim that this is equivalent to checking that 
each generator of $S$ is in $eS$ for some idempotent $e$.

If Equation \ref{eq:hasid} holds, then it is certainly the case
that every generator $\overline{b_i}$ is in $eS$ for some 
idempotent $e$. To see the
reverse implication,  suppose $w \in (\mathbb{N}^n)_\theta$ with
$w_i \neq 0$. Then $w = b_i + w'$, and since $\overline{b_i} \in eS$ for some
idempotent $e$, $\overline{w} = \overline{b_i}\overline{w'} \in eS$
and Equation  \ref{eq:hasid} holds.

It only remains to see that Algorithm \ref{A:hasid} actually tests
whether every generator belongs to some $eS$. By Algorithm \ref{A:idealbasis}
we are able to calculate the basis of the ideal in $\N^n$ of  all
vectors which represent elements of the form $es$ for some idempotent
$e$ and $s \in S$. Then by minimality of $b_i$, $b_i$ is in this ideal
if and only if it is an element of $B$.  
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Deciding whether a semigroup has zero divisors}\label{s:zerodiv}

Let $S$ be a commutative semigroup with zero
given by a canonical semigroup (or monoid)
presentation $\langle n + 1 \mid \rho \rangle$, where $b_{n+1}$
represents the zero. The following proposition allows us to decide
whether $S$ has proper zero divisors. We may assume without loss
of generality that there are no two generators representing the same
element of $S$.

%%===================================================================
\begin{proposition}
With notation as above, $S$ has zero divisors if and only if
there is some rule of the form $(l_1, \ldots, l_n,0) \rightarrow
b_{n+1}$
in $\rho$.
\end{proposition}

\begin{proof}
Suppose that $S$ has zero divisors with $xy = 0$ but
$x$ and $y$ both nonzero. Then since $x$ and $y$ are nonzero,
they are represented by elements of the form 
$(x_1, \ldots, x_n,0)$ and $(y_1, \ldots, y_n,0)$
respectively, and we have a sequence of reductions
$(x_1 + y_1, \ldots, x_n + y_n,0) \rightarrow^* (z_1, \ldots, z_n,1)
\rightarrow^* b_{n+1}$.
Therefore, there is a rule in $\rho$ of the form
$(l_1, \ldots, l_n,0) \rightarrow (l_1', \ldots, l_n',1)$, but since
$\rho$ is reduced and $(l_1', \ldots, l_n',1) \sim_\rho b_{n+1}$,
the rule must be $(l_1, \ldots, l_n,0) \rightarrow b_{n+1}$ as required.

Conversely, suppose there is a rule of the form
$(l_1, \ldots, l_n,0) \rightarrow b_{n+1}$ then either
we can decompose $(l_1, \ldots, l_n,0)$ as $u + v$ with
$u$ and $v$ nonzero vectors, or
$(l_1, \ldots, l_n,0) =  b_j$ for some $j < n+1$, contradicting
the assumption that no two generators represent the same element of
$S$. In the former case, we know that $u \not\sim b_{n+1}$ and 
$v \not\sim b_{n+1}$ for otherwise $\rho$ would not be canonical. 
Therefore $S$ has the proper
zero divisors $\overline{u}$ and $\overline{v}$.  
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Presentations for commutative semigroups}

Most of the calculations in our main algorithm 
involve computing
ideals, subgroups and quotients of a semigroup. 
Here we show how to write down finite presentations 
for these objects.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Presentation for a maximal subgroup}\label{s:maxsubgrp}

Let $S$ be defined by the presentation 
${\mathcal Q}=\langle n\mid \rho\rangle$.
Fix an idempotent $e\in S$ and let $G$ be the maximal subgroup
of $S$ containing $e$. Put  $\Sigma=\{i\in [i]\,\mid\,e\overline{b_i}\in G\}$
and $\mathbb{N}^{\Sigma}=\{w\in\mathbb{N}^n\mid w_i\neq 0\Rightarrow i
\in\Sigma\}$. Notice that $\mathbb{N}^{\Sigma}\cong\mathbb{N}^m$
where $m=|\Sigma|$, and denote by $\tau$ the obvious
isomorphism from $\mathbb{N}^{\Sigma}$ to $\mathbb{N}^m$.
In particular denote by $d_i$ the image of $b_i$ under $\tau$,
for $i\in\Sigma$; $\mathbb{N}^m$ is clearly generated by the $d_i$
($i\in\Sigma$).

%%===================================================================
\begin{lemma}\label{gwords}
If $w\in \mathbb{N}^n$ is such that $\overline{w}\in G$ then
$w_i \neq 0$ implies $i\in\Sigma$.
\end{lemma}
\emph{Proof.}
Let $w\in \mathbb{N}^n$ be such that $\overline{w}\in G$ and let $i$ be 
such that $w_i\neq 0$. Then $w=w^{\prime}+b_i$, with $w^{\prime}\in
(\mathbb{N}^n)$.

Since $\overline{w} = \overline{w}e \in G$  there is some
$z \in G$ such that $z \overline{w} = z \overline{w} e = e$,
whence $(z \overline{w'}) (\overline{b_i} e) = e$ which shows that
$\overline{b_i} e {\cal H} e$. But since $G$ is precisely the 
${\cal H}$-class containing $e$, we have $\overline{b_i}e \in G$.    
This shows that $i \in \Sigma$ as required.  $\square$

One consequence of the lemma above is that we may fix a 
word $w_e\in\mathbb{N}^{\Sigma}$ such that $\overline{w_e}=e$. 

Indeed, with notation as set out above, we have:

\begin{proposition}\label{p:ggens}
The maximal subgroup $G$ containing $e$ is a quotient of 
$\mathbb{N}^m$ under the homomorphism
$\psi: v \mapsto \overline{\tau^{-1}(v)}e$ which extends the map
$d_i \mapsto \overline{b_i} e$, for $i \in \Sigma$.
\end{proposition}
\emph{Proof.}
The homomorphism $\psi$ clearly lands on $eS$, we show that
its image is precisely $G$.
\begin{eqnarray*}
s \in \mbox{Im}(\psi) & \Leftrightarrow & s = \overline{\tau^{-1}(v)}e \mbox{
for some $v \in \mathbb{N}^m$} \\
&\Leftrightarrow & s = \overline{w}e \mbox{ for some $w \in
\mathbb{N}^\Sigma$}\\
&\Leftrightarrow & s = \overline{w + w_e} \mbox{ for some $w \in
\mathbb{N}^\Sigma$}\\
&\Leftrightarrow & s \in G \mbox{ by Lemma \ref{gwords}.}\square
\end{eqnarray*}

%%===================================================================
\begin{theorem} \label{T:maxgroup}
The group $G$ is defined by the following 
commutative monoid presentation
\begin{eqnarray}
\label{rel7}\mathcal{P}=\langle m&\mid&
\tau(u)=\tau(v)\ 
((u=v)\in \rho\cap(\mathbb{N}^{\Sigma}\!\times\mathbb{N}^{\Sigma})),\\
\label{rel8}&&\tau(w_e)=0 
\end{eqnarray}
\end{theorem}

\begin{proof}
Let $\psi$ be as defined in Proposition \ref{p:ggens}.
To show that $\mathcal{P}$ defines $G$ we now have to prove
that $x\sim_{\mathcal{P}}y$ if and only if $\psi(x)=\psi(y)$ 

If $x\sim_{\mathcal{P}}y$ then we have to show that
$\overline{\tau^{-1}(x)}e=\overline{\tau^{-1}(y)}e$.
Now, $x\sim_{\mathcal{P}}y$
means that there is an elementary sequence $x=\alpha_1,\alpha_2,
\ldots,\alpha_k=y$ with respect to $\mathcal{P}$ and hence
$\tau(w_e)+x=\tau(w_e)+\alpha_1,\tau(w_e)+\alpha_2,\ldots,
\tau(w_e)+\alpha_k=\tau(w_e)+y$ is also an elementary sequence from 
$\tau(w_e)+x$ to $\tau(w_e)+y$ with respect to $\mathcal{P}$ with 
$\overline{w_e+\tau^{-1}(\alpha_j)}=e\overline{\tau^{-1}(\alpha_j)}\in G$ 
($1\leq j\leq k$).
If the relation applied to obtain $\alpha_i$ from $\alpha_{i-1}$
is from (\ref{rel7}) then clearly $w_e+\tau^{-1}(\alpha_i)$ is obtained
from $w_e+\tau^{-1}(\alpha_{i-1})$ by applying a relation from $\mathcal{Q}$.
Else, if $\alpha_i$ is obtained from $\alpha_{i-1}$ by applying the
relation $\tau(w_e)=0$ then it also follows that
$\tau(\alpha_{i-1}) - w_e = \tau^{-1}(\alpha_i)$ so that
$2w_e+\tau^{-1}(\alpha_i) = w_e+\tau^{-1}(\alpha_{i-1})$ and by the fact that
$w_e$ represents an idempotent in $S$,
$w_e+\tau^{-1}(\alpha_i)
\sim_{\mathcal{Q}}w_e+\tau^{-1}(\alpha_{i-1})$. 
Thus $w_e+\tau^{-1}(x)\sim_{\mathcal{Q}}w_e+\tau^{-1}(y)$ and
$\overline{\tau^{-1}(x)}e=\overline{\tau^{-1}(y)}e$ as required. 

Conversely suppose that $\psi(x)=\psi(y)$, and 
$x=d_{i_1}+\ldots+d_{i_k}\in\mathbb{N}^m$,
$y=d_{j_1}+\ldots+d_{j_l}\in\mathbb{N}^m$.
Then $\psi(x)=\psi(y)$ implies that
$$e\overline{e_{i_1}}\ldots e\overline{e_{i_k}}=
e\overline{e_{j_1}}\cdots e\overline{e_{j_l}},$$
and therefore  
$$e\overline{e_{i_1}}\ldots\overline{e_{i_k}}=
e\overline{e_{j_1}}\cdots \overline{e_{j_l}},$$
because $S$ is commutative and $e$ is idempotent.
Since $\overline{w_e}=e$ we then have
$$\overline{w_e}\,\overline{e_{i_1}}\ldots\overline{e_{i_k}}=
\overline{w_e}\,\overline{e_{j_1}}\cdots \overline{e_{j_l}},$$
and hence 
$$w_e+e_{i_1}+\cdots+e_{i_k}\sim_{\mathcal{Q}} w_e+e_{j_1}+\cdots
+e_{j_l}.$$

So, there is an elementary sequence from 
$w_e+e_{i_1}+\cdots+e_{i_k}$ to $w_e+e_{j_1}+\cdots +e_{j_l}$
with respect to $\mathcal{Q}$. If some element $w$ in this
elementary sequence is not in $\mathbb{N}^{\Sigma}$
then, by Lemma \ref{gwords}, $\overline{w} \notin G$ which is a 
contradiction. Therefore all relations used to obtain 
$w_e+e_{j_1}+\cdots +e_{j_l}$ from $w_e+e_{i_1}+\cdots+e_{i_k}$
are in $\rho\cap(\mathbb{N}^{\Sigma}\times\mathbb{N}^{\Sigma})$, and thus 
$$\tau(w_e+e_{i_1}+\cdots+e_{i_k})\sim_{\mathcal{P}}
\tau(w_e+e_{j_1}+\cdots +e_{j_l}).$$
But this means that
$$\tau(w_e)+d_{i_1}+\cdots+d_{i_k}\sim_{\mathcal{P}}
\tau(w_e)+d_{j_1}+\cdots +d_{j_l}.$$
Since $\tau(w_e)=0$ is a relation in $\mathcal{P}$ then also
$$0+d_{i_1}+\cdots+d_{i_k}\sim_{\mathcal{P}}
0+d_{j_1}+\cdots +d_{j_l},$$
and therefore
$$u=d_{i_1}+\cdots+d_{i_k}\sim_{\mathcal{P}}d_{j_1}+\cdots +d_{j_l}=v.$$
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Presentation for a Rees quotient}\label{s:rqpres}

Let $S$ be defined by the presentation
${\mathcal Q}=\langle n\mid \rho\rangle$.
Let $E$ denote the set of idempotents of $S$, $F$ 
a subset of $E$ and $e$ a maximal element of $F$.
Denote by $\widehat{FS}$ the ideal generated by
$F\setminus \{e\}$ and let $T_e$ be the Rees quotient
$FS/\widehat{FS}$. We need to calculate this type of
quotient in step 4 of our main 
algorithm, Algorithm \ref{A:ispir}.

%%===================================================================
\begin{lemma}
The semigroup $T_e$ is defined by the  commutative monoid presentation
\begin{eqnarray*}
\mathcal{P}=\langle n+1&\mid& \rho,\\
&&w_e=0,\\
&&b_i+b_{n+1}=b_{n+1} (1\leq i\leq n+1),\\
&& w_f=b_{n+1} (f\in F\setminus\{e\})\rangle
\end{eqnarray*}
where $w_f\in \mathbb{N}^n$ is such that $\overline{w_f}=f\in E$.
Obviously, generator $b_{n+1}$ represents the zero of $T_e$.
\end{lemma}

\begin{proof}
We define a (monoid) homomorphism 
$$\psi: \mathbb{N}^{n+1}\rightarrow T_e$$
by extending the mapping
$$b_i\mapsto e\overline{b_i} (1\leq i\leq n), b_{n+1}\mapsto 0_{T_e}.$$

We start by showing that $\psi$ is onto. So let $\alpha\in T_e$.
If $\alpha=0_{T_e}$ then $\psi(b_{n+1})=\alpha$.
If $\alpha\neq 0_{T_e}$ then $\alpha\in FS\backslash\widehat{FS}$
so that $\alpha=es$ for some $s\in S$. If $s=\overline{w}$
($w\in\mathbb{N}^n$) then $\psi(w)=e\overline{w}=es$ as required.

We now have to show that $\psi(x)=\psi(y)$ if and only if
$x\sim_{\mathcal{P}}y$.
Suppose $x\sim_{\mathcal{P}}y$ by a single application of a
relation of $\mathcal{P}$. If this relation is in $\rho$ or the
relation is $w_e = 0$ then $\overline{x} = \overline{y}$ and
therefore $\psi(x) = \psi(y)$. If the relation is $b_i + b_{n+1} = b_{n+1}$ 
or $w_f = b_{n+1}$ for $f \in F \setminus \{e\}$ 
then $\psi(x) = \psi(y) = 0$. 

Now suppose that $\psi(x)=\psi(y)$.
Either $\psi(x)=\psi(y)=0_{T_e}$ or $\psi(x),\psi(y)\neq 0$.

In the first case it is enough to show that $u\sim_{\mathcal{P}}b_{n+1}$. Then
by symmetry, $v\sim_{\mathcal{P}}b_{n+1}$, and 
by transitivity $u \sim_\mathcal{P} v$. 
If $u=b_{n+1}+z$ for $z\in(\mathbb{N}^n)_{\theta}$ then
clearly $u\sim_{\mathcal{P}}b_{n+1}$.
Otherwise
$\psi(u)=e\overline{u}\in\widehat{FS}$
and thus there exists $f\in F\setminus\{e\}$ and $u^{\prime}\in\mathbb{N}^n$ 
such that
$$w_e+u\sim_{\mathcal{Q}}w_f+u^{\prime}.$$
It then follows that
$$w_e+u\sim_{\mathcal{P}}w_f+u^{\prime}\sim_{\mathcal{P}}b_{n+1}.$$
Finally, $u=0+u\sim_{\mathcal{P}}w_e+u\sim_{\mathcal{P}}b_{n+1}$.

Now suppose that $\psi(u),\psi(v)\neq 0_{T_e}$. 
Notice that neither $u$ nor $v$ can be written as a sum of
$b_{n+1}+z$ (with $z\in(\mathbb{N}^n)_{\theta}$), for otherwise
$u\sim_{\mathcal{P}}b_{n+1}$, $v\sim_{\mathcal{P}}b_{n+1}$
and $\psi(u)=\psi(v)=0$.
Now, $e\overline{u}=e\overline{v}$ and hence 
$w_e+u\sim_{\mathcal{Q}}w_e+v$.
Therefore also $w_e+u\sim_{\mathcal{P}}w_e+v$.
Thus, we have $u=0+u\sim_{\mathcal{P}}w_e+u\sim_{\mathcal{P}}
w_e+v\sim_{\mathcal{P}}0+v=v$,
as required.  
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{The quotient of a semigroup by a group of units}\label{s:unitquo}

Let $\langle n \mid \rho \rangle$ be a monoid presentation for $M$,
let $M^*$ be its group of units, and let $M^*_f$ be the group of all units
with finite order. In Algorithm \ref{A:ispir}, we need to compute the
monoid $M/M^*_f$.

>From Section \ref{s:maxsubgrp} we are able to compute a presentation
$\mathcal{P} = \langle r \mid \sigma \rangle $ for $M^*$ and an isomorphism 
$\tau: \mathbb{N}^\Sigma \rightarrow \mathbb{N}^r$, where 
$\tau^{-1}$ dictates the embedding from the group $\mathbb{N}^r/\sigma$ 
into $M$.

Using {\tt IndependentGenerators}  we find the sequence
$(g_1, \ldots, g_m, h_1, \ldots, h_q)$ of elements of 
$\mathbb{N}^r$ which represent the generators of the distinct
cyclic components of $M^*$. We then have that 
$\{\tau^{-1}(g_1), \ldots, \tau^{-1}(g_m)\} \subset \mathbb{N}^\Sigma \subseteq
\mathbb{N}^n$ generate $M^*_f$ under the map $\overline{\cdot}$.
We show that:
\begin{lemma}\label{t:mgpres}
The monoid $M/M^*_f = \{sM^*_f \mid s \in M\}$ 
is given by the monoid presentation
$$\mathcal{Q} = \langle n \mid 
\rho, \tau^{-1}(g_i) = 0 \mbox{ for $1 \leq i \leq m$}\rangle.$$
\end{lemma}

\begin{proof}
Define $\psi : \{b_1, \ldots, b_n\}  \rightarrow M/M^*_f$ by
$b_i \mapsto \overline{b_i} M^*_f$, and extend homomorphically. 
In particular, $0 \mapsto M^*_f$ and
$(a_1, \ldots, a_n) \mapsto 
\overline{b_1}^{a_1} \ldots \overline{b_n}^{a_n} M^*_f$.
Clearly $\psi$ is onto.
We only need to show that $\psi$ induces a well defined injection from
the monoid presented by $\mathcal{Q}$ into $M/M^*_f$, which is to say
$$u \sim_\mathcal{Q} v \Leftrightarrow \psi(u) = \psi(v).$$

In the forward direction, the relations $\rho$ certainly hold in 
$M/M^*_f$ since they hold in $M$. We only need to show that 
for all $i$, $\psi(\tau^{-1}(g_i)) = \psi(0)$. But by definition,
$\overline{\tau^{-1}(g_i)} \in M^*_f$ therefore, 
\begin{eqnarray*}
\psi(\tau^{-1}(g_i))& = & \overline{\tau^{-1}(g_i)}M^*_f \\
		& = & M^*_f \\
		& = & \psi(0)
\end{eqnarray*}
as required.

For the reverse implication, suppose 
that $\psi(u) = \psi(v)$. Then
$\overline{u} = \overline{v} h$ for some $h \in M^*_f$.
Now $h = \overline{\tau^{-1}(g_{i_1})} \ldots \overline{\tau^{-1}(g_{i_k})}$,
so that 
$u \sim_\mathcal{P} v + \tau^{-1}(g_{i_1}) + \cdots + \tau^{-1}(g_{i_k})$
and therefore $u \sim_\mathcal{Q} v$ by use of the relations
$\tau^{-1}(g_{i}) = 0$.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Identifying principal ideal rings}

\begin{algorithm}
\caption{Decides whether $k[S]$ is a PIR with identity}
\label{A:ispir}
\begin{algorithmic}[1]
\STATE Determine whether $k[S]$ has an identity and return \emph{false} if not
-- see Lemma \ref{L:hasid}.
\STATE Compute the topologically sorted sequence of idempotents $f_0, f_1,
\ldots, f_N$ as described above.
\FOR{$i \in \{1, \ldots, n\}$}
{
        \STATE $M \leftarrow S\{f_0, \ldots, f_i\} / S\{f_0, \ldots, f_{i-1}\}$
        \label{l:reesquo}

        \STATE $G \leftarrow $ group of units of $M$ 
        \COMMENT{see Lemma \ref{T:maxgroup}} 
        \STATE $(p_1^{k_1}, \ldots, p_m^{k_m}, \N^q) \leftarrow${\tt
AbelianGroupDecomposition}$(G)$

        \IF{$|M| < \infty$} 
        {
                \STATE \COMMENT{we must be in case (ii) or (iii)}
                \IF{$|M| = |G| + 1$} 
                {
                        \IF{$p = \char(k) > 0$} 
                        {
                                \IF{$p$ occurs at most 
																			once in $\{p_1, \ldots, p_m\}$}
                                        \STATE {\bf next} $i$
                                \ELSE
                                        \STATE {\bf return} \emph{false}.
                                \ENDIF
                        }
                        \ELSE
                                \STATE {\bf next} $i$
                        \ENDIF
                }
                \ELSE
                {
                        \STATE \COMMENT{we are in case (iii)}
                        \IF{$p = \char(k) > 0$ and $p | |G|$}
                                \STATE {\bf return} \emph{false}
                        \ELSE
													\IF{$M/G$ is cyclic nilpotent}
				\STATE {\bf next} $i$
					\ELSE
					\STATE {\bf return} \emph{false}
					\ENDIF
                        \ENDIF
                }
                \ENDIF
        }
        \ELSE 
        {
                \STATE \COMMENT{$M$ is infinite}
                \IF{$M$ has zero divisors (see Section \ref{s:zerodiv})}
                        \STATE {\bf return} \emph{false}
                \ELSE
                        \STATE calculate $M_\theta$
                \ENDIF
								\STATE $S \leftarrow (M_\theta)/(M_\theta)^*_f$ \COMMENT{see Section \ref{s:unitquo}}
   			\IF{$p = \char(k) > 0$ and $p \mid |(M_\theta)^*_f|$}
									\STATE {\bf return} \emph{false}
								\ENDIF
								\IF{$S$ is isomorphic to $\mathbb{N}$ or $\mathbb{Z}$
										(see Section \ref{s:freemon})}
									\STATE {\bf next} $i$
								\ELSE
									\STATE {\bf return} \emph{false}
								\ENDIF
        }
        \ENDIF
}
\ENDFOR
\STATE {\bf return} \emph{true}
\end{algorithmic}
\end{algorithm}

Given a finitely generated commutative semigroup $S$ we
may calculate the (finite) set $E(S)$ of idempotents with the algorithm
{\tt Idempotents} of Rosales et.~al.~\cite{pRGG99}. 
The set of idempotents of a semigroup admits a partial order
$\leq_E$ given by $e \leq_E f$ if $ef = e$.
Under the this partial order we may order the set of idempotents
into a sequence $(f_i)$ {\em topologically}, which is to 
say $f_i \leq_E f_j$ implies that $i < j$. 
If $S$ has a zero, write this sequence $f_0 = 0, f_1, \cdots, f_N$,
otherwise write it as $f_1, \ldots, f_N$
(note that deciding whether $S$ has a zero is a simple matter of 
searching through its idempotents).

As described in \cite{pDJW91} Proposition 1.2,  a  topologically 
ordered sequence of idempotents determines a sequence of ideals
of $S$ as follows:
if $0 \in S$, put $S_0 = {0}$, otherwise put $S_0 = \emptyset$; 
knowing $S_i$, put $S_{i+1} = S_i \cup S f_{i+1}$. We refer to this
algorithm as {\tt IdealChain}.  Then
each Rees quotient $S_i/S_{i-1}$ is a monoid with zero whose only
nonzero idempotent is the identity. This monoid is clearly
$S\{f_0, \ldots, f_i\} / S\{f_0, \ldots, f_{i-1}\}$ whose 
presentation is calculated in Section \ref{s:rqpres}.
 
Theorem 2.7 of \cite{pDJW91} characterizes commutative semigroup
algebras with identity 
which are principal ideal rings  in terms of the existence of 
{\em some} chain of ideals $S = S_N \supset S_{N-1} 
\supset \cdots \supset S_0$. 
It is a scholium of the proof of this theorem that 
we may use the {\em particular} chain of ideals as constructed by
algorithm  {\tt IdealChain}. We state the stronger form of this 
theorem:

%%===================================================================
\begin{proposition}\label{p:djwthm}
Assume $|S| > 1$. The semigroup algebra with identity $k[S]$ is a
principal ideal ring if and only if {\tt IdealChain}($S$),
which we write $S=S_n \supset \cdots \supset S_0$, is
such that for all $1 \leq i \leq n$ one of the following conditions
holds:
\begin{itemize}
\item[(i)] 
$(S_i/ S_{i-1})_\theta$ is a finite group $G$ extended by an
infinite cyclic monoid or group, and $\char(k) \not{|} |G|$ when
$\char(k) \neq 0$. 
\item[(ii)] 
$(S_i/ S_{i-1})_\theta$ is a finite group with 
cyclic $p$-primary component when $p = \char(k) \neq 0$.
\item[(iii)] 
$S_i/ S_{i-1}$ is a cyclic nilpotent extension of a
finite group $G$, and if $p  = \char(k) \neq 0$ then
$p  \not{|} |G|$. 
\end{itemize}
\end{proposition}

Based on the abstract description given in 
the proposition above we show:

%%===================================================================
\begin{theorem}\label{t:main}
Given a presentation for a commutative semigroup
$S$  and the characteristic of a field $k$, 
Algorithm \ref{A:ispir} decides whether $k[S]$ is a principal
ideal ring with identity.
\end{theorem}

Before we embark on a proof we need the following 
fact relating to case (i) above.

%%===================================================================
\begin{lemma}\label{l:fext}
If $M$ is an infinite cyclic monoid or group extension of
a finite group, then it is an infinite cyclic monoid or group extension of
$M^*_f$, the finite subgroup of $M$ consisting of all units of finite 
order.
\end{lemma}

\begin{proof}
Suppose $M$ is an infinite cyclic monoid or group extension of
a finite group. Then certainly there is some subgroup
$K \leq M^*_f$ such that $M/K$ is isomorphic to $\mathbb{N}$ or 
$\mathbb{Z}$. We show that if $K \neq  M^*_f$ then
$M/K$ is not isomorphic to $\mathbb{N}$ or 
$\mathbb{Z}$.

Suppose by way of contradiction 
that $a \in M^*_f \setminus K$, and that $\{a, a^2, \ldots, a^m\}$ are
the distinct powers of $a$.  Then
$\{aK, a^2K, \ldots, a^mK\}$  is a  finite subgroup of $M/K$ of
size at least $2$, whereupon it is impossible for $M/K$ to be
$\mathbb{N}$ or $\mathbb{Z}$. 
\end{proof}

An almost identical argument gives us the following 

%%===================================================================
\begin{lemma}\label{l:cycnilp}
If $M$ is a cyclic nilpotent extension of a finite group, then
$M$ is a cyclic nilpotent extension of $M^*_\theta$. $\square$
\end{lemma} 

%%-------------------------------------------------------------------
\begin{proofthm} of Theorem \ref{t:main}.
Suppose that $k[S]$ is a principal ideal ring with identity.
After ensuring that $k[S]$ has an identity, we 
compute the topologically sorted sequence of idempotents of $S$.
Fix some $i$ -- the index of the {\bf for} loop. To see that the 
algorithm returns \emph{true} it is enough to show that
with $M$ the Rees quotient $S_i/S_{i-1}$ of consecutive elements of 
{\tt IdealChain}$(S)$ (line \ref{L:hasid}), \emph{false} is not
returned and we commence the next iteration of the {\bf for} loop through
the command {\bf next}. 

We know that $M$ satisfies one of the
three conditions of  Proposition \ref{p:djwthm}. Suppose 
$M$ satisfies condition (i). Then $M$ is certainly infinite
(which we can check by looking at its canonical presentation --
see \cite{bRG99}) which brings us to line 32.
Since $M_\theta$ is a semigroup, we calculate it and at line 38 
we calculate the quotient $S$ of $M_\theta$ by its group of units of 
finite order.  If the characteristic of the field is $p > 0$ then
the we verify at line 39 that $(M_\theta)^*_f$ has no elements of order $p$, 
which can be done by `brute force' since we know a generating set
for  $(M_\theta)^*_f$ (see Section \ref{s:unitquo}).
By Lemma \ref{l:fext}, $S$ is isomorphic to 
$\mathbb{N}$ or $\mathbb{Z}$ (which we check -- see 
Section \ref{s:freemon}), and we loop as required at line 43.

In case $M$ satisfies condition (ii), $M_\theta$ is a finite group,
and we arrive at line 9. If the characteristic of the field is 
$0$ loop at line 17, and if the characteristic is $p > 0$, then
we loop precisely when $p$ occurs at most once in 
the {\tt AbelianGroupDecomposition}, which is the case
as $M_\theta$ has cyclic $p$-primary component.

Finally, if $M$ satisfies condition (iii) then its set 
of elements is $\bigcup_{m \in M}mG$ for some group $H$  of units of $M$
with $H$ finite. Since $M/H$ is cyclic nilpotent it is finite, and
therefore there are only finitely many distinct $mH$ with $m \in M$, whence
$M$ is also finite. Therefore we are at line 8. Setting $G = M_\theta^*$,
we note that by Lemma \ref{l:cycnilp}, $M/G$ is cyclic nilpotent.
If $|M| = |G| + 1$ and the characteristic of the field is $0$ we certainly
loop; if it is $p >0$, then since $G$ has no elements of order $p$, 
$p$ doesn't occur in $\{p_1, \ldots, p_m\}$ and we loop as required. 
On the other hand, if  $|M| > |G| + 1$ then we arrive at step 21. 
Even if the characteristic of the field is $p > 0$ we know that
$G$ has no elements of order $p$, therefore $p$ does not divide the
order of $G$, and we arrive at line 24 where 
$M/G$ is computed as described in Section \ref{s:unitquo}.
Since this monoid is finite, we check by `brute force' that it is 
cyclic nilpotent and loop as required.

Conversely, given  $M = S_i/S_{i-1}$ we show that in order to
reach one of the {\bf next} statements, $M$ must satisfy one of the conditions
of Proposition  \ref{p:djwthm}. Suppose we loop at:
\begin{itemize}
\item \emph{line 12} then $M_\theta$ is a finite group, the characteristic
of the field is $p > 0$,  with at most one cyclic factor of $p$-power order,
and we are in case (ii);
\item \emph{line 17} then $M_\theta$ is a finite group and the characteristic
of the field is $0$, and we are in case (ii);
\item \emph{line 25} then $M$ is a cyclic nilpotent extension of a 
finite group and if the characteristic of
the field is $p > 0$ then $p$ is not a divisor of $|G|$, and we are in case
(iii);
\item \emph{line 40} then $M_\theta$ is an extension of a finite group 
$(M_\theta)^*_f$ by $\mathbb{N}$ or $\mathbb{Z}$ and if the 
characteristic of the field is $p > 0$ then $p$ is not a divisor 
of $|(M_\theta)^*_f|$, and  we are in case (i).
\end{itemize}

In summary, we have shown that execution reaches a {\bf next} statement
precisely when $S_i/S_{i-1}$ satisfies one of conditions (i)--(iii) 
in Proposition \ref{p:djwthm}, and hence the algorithm decides
whether $k[S]$ is a principal ideal ring with identity.  
\end{proofthm}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
{ACKNOWLEDGEMENTS}
\end{center}

The first author is financially supported by the
Sub-Programa Ci\^encia e Tecnologia do 2$^{\circ}$ 
Quadro Comunit\'ario de Apoio (grant number BD/ 15623/98). 
The author also ackowledges the support of
the Centro de \'Algebra da Universidade de Lisboa and of the Projecto
Praxis 2/2.1/MAT/73/94.

The first and third authors gratefully acknowledge the 
hospitality of David Easdown, their host at The  University of Sydney
where this work was carried out.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{thebibliography}{9}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\bibitem{braga99} 
I.M.~Ara\'ujo and A.~Solomon, 
{\em Computing with Semigroups in GAP},
Proc. Internat. Conf. on Semigroups (Braga, 
Portugal, 1999), to appear.

\bibitem{bBeckWeis}
T.~Becker and V.~Weispfenning, 
{``Gr\"{o}bner Bases, A Computational Approach 
to Commutative Algebra''}, 
Springer-Verlag, New York, 1993.

\bibitem{CaRoRuTh:Reidmeister}
C.M.~Campbell, E.F.~Robertson, N.~Ru\v{s}kuc and  R.M. Thomas,
{\it Reidemeister-Schreier type rewriting for semigroups},
Semigroup Forum {\bf 51} (1995), 47--62.

\bibitem{CaKe98:gwpc}
J. Cazaran and A.V. Kelarev,
{\it Generators and weights of polynomial codes},
Arch. Math. (Basel) {\bf 69} (1997), 479--486.

\bibitem{pDJW91}
F.~Decruyenaere, E.~Jespers and P.~Wauters, 
{\it On commutative principal ideal semigroup rings},
Semigroup Forum {\bf 43} (1991), 367--377.

\bibitem{p2}
D.K.Faddeev,  
\emph{On the equivalence of systems of integral matrices},
Izv. Akad. Nauk SSSR Ser. Mat., Vol. 30 (1966) 449--454. 

\bibitem{gap} 
The GAP Group, {\gap} -- Groups, Algorithms and Programming,
Version 4.1; http://www-gap.dcs.st-and.ac.uk/$\sim$gap (Aachen, St Andrews,
1999).

\bibitem{Grillet:book}
P.A.~Grillet,
{``Semigroups: an Introduction to the Structure Theory''},
Marcel Dekker, New York, 1995.

\bibitem{JO96} 
E. Jespers, J. Okni\'{n}ski, 
{\it Semigroup algebras that are principal ideal rings}, 
J. Algebra {\bf 183} (1996), 837--863.

\bibitem{LaMa92:cciga}
P. Landrock and  O. Manz,
{\it Classical codes as ideals in group algebras},
Des. Codes Cryptogr. {\bf 2} (1992), 273--285.

\bibitem{poniz87} 
J.~S.~Ponizovskii, 
{\it Semigroup rings}, 
Semigroup Forum {\bf 36} (1987), 1--46.

\bibitem{pRGG99}
J.C.~Rosales, P.A.~Garc\'{\i}a-S\'{a}nchez and 
J.I.~Garc\'{\i}a-Garc\'{\i}a,
\emph{Commutative ideal extensions of Abelian groups},
Semigroup Forum, (to appear).

\bibitem{bRG99}
J.C.~Rosales and  P.A.~Garc\'{\i}a-S\'{a}nchez,
{\it Finitely generated commutative monoids}, 
Nova Science Publ., New York, 1999.

\bibitem{Ru99}
N.~Ru\v{s}kuc,
{\it Presentations for subgroups of monoids},
J. Algebra 220 (1999)(1), 365-380.

\bibitem{sims}
C.C.~Sims,
{\it Computation with finitely presented groups},
University Press, Cambridge, 1994.

\bibitem{taitslin}
M.A.~Ta\u{\i}tslin,
{\it The isomorphism problem for commutative 
semigroups solved affirmatively},
``Theory of Models and its Applications'', 
Kazakh. Gos. Univ., Alma-Ata, 1980, 75--81. 

\bibitem{p1}
M.A.~Ta\u{\i}tslin,
{\it The isomorphism problem for commutative semigroups},
Mat. Sb. {\bf 93} (1974), 103--128. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\end{thebibliography}
\end{document}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%








